---
layout: ../../../../layouts/MarkdownPostLayout.astro
pubDate: 2025-03-12
title: "EventLoop"
description: "Javascript EventLoop 간단하게 정리하기"
tags: ["javascript"]
---

> 불과 3년 정도 전만하더라도 EventLoop에 관련하여 잘 정리되어 있는 그림이나 포스팅을 찾아 보기 힘들었는데 요즘에는 유튜브에서 인터렉티브하게 EventLoop에 의해 어떻게 비동기로 동작이 되는지를 설명해주는 것도 많고, 양질의 블로그도 많아졌다. 오랜만에 상기해보고 간단하게 내용을 정리해보자.

Javascript의 이벤트 루프는 한마디로 말하면 "싱글스레드 언어에서 비동기 작업을 효율적으로 처리하게 해주는 메커니즘"이다.
˝
API통신을 위해 fetch를 한다던지, 시간을 두고 실행한다던지 하는 니즈들이 추가되면서 좀 더 원활한 브라우저 환경을 위해 비동기로 동작 해야만 했다.이때, 싱글스레드의 한계를 보완하기 위해 Event Loop가 콜백을 적절한 타이밍에 실행하도록 조율하는 역할이 더욱 중요해졌다.
브라우저의 Web API(setTimeout, fetch 등)는 백그라운드에서 비동기 작업을 수행하고, Event Loop는 이를 적절한 시점에 실행하도록 관리한다.

일반적으로 Javascript 소스는 자체 엔진에 있는 콜스택에 의해 실행컨텍스트들이 실행된다. 하지만, 비동기로 동작해야 하는 WebAPI는 브라우저에서 처리되고 Promise들 같은 경우에는 마이크로태스크큐에 있다가 자바스크립트엔진의 콜스택으로 넘어오게 된다.. 

예를 들어, WebAPI의 setTimeout같은 API는 EventLoop가 브라우저의 TimerAPI로 전달해서 백그라운드에서 시간이 지나게 된다. 그렇게, 시간이 모두 지나면 브라우저의 태스크 큐에 쌓이게 되고, 이벤트 루프가 콜 스택이 비어있다고 판단하게 되면 EventLoop가 콜스택으로 setTimeout의 콜백함수를 전달하게 된다. 그리고 엔진에 의해 실행된다.

이런 식으로 이벤트 루프는 Javascript 엔진의 콜스택이 비어있는지 주기적으로 바라보면서, 비어있다면 Promise같은 작업이 끝났을 때 들어오는 마이크로태스크큐의 컨텍스트를 콜스택으로 옮겨오고, 만약 마이크로태스크큐도 비어있다면 태스크큐에서 컨텍스트를 콜스택으로 가지고 와서 실행한다.

> Javascript는 왜 싱글스레드로 설계 되었나?
1996년 넷스케이프에 의해 Javascript가 등장하고 그 당시 멀티 스레드가 보편적으로 깔려있지 않은 세대였기도 하고, 간단한 스크립트 수준을 동작하게 하기 위해서 등장했기 때문에 싱글 스레드로 설계 되었다.

