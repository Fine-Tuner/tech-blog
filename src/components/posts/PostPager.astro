---
import type { PostData } from "../../types/post";

const { posts, currentUrl } = Astro.props as {
  posts: PostData[];
  currentUrl: string;
};

// posts는 최신순으로 정렬되어 있다고 가정
const normalize = (inputUrl: string) => {
  if (!inputUrl) return "";
  // '/path', '/path/', '/path/index.html' 모두 동일 경로로 취급
  let normalizedUrl = inputUrl.replace(/\/index\.html$/, "/");
  normalizedUrl = normalizedUrl.replace(/\/+$/, "");
  return normalizedUrl;
};

const index = posts.findIndex(
  (p) => normalize(p.url) === normalize(currentUrl),
);
const prev = index > 0 ? posts[index - 1] : null; // 이전 글 (더 최신)
const next = index >= 0 && index < posts.length - 1 ? posts[index + 1] : null; // 다음 글 (더 오래된)
---

{
  (prev || next) && (
    <nav class="post-pager" aria-label="이전/다음 글 내비게이션">
      {prev && (
        <a
          class="prev"
          href={prev.url}
          aria-label={`이전 글: ${prev.frontmatter.title}`}
        >
          <span class="icon" aria-hidden="true">
            ←
          </span>
          <span class="spacer" aria-hidden="true" />
          <span class="label">{prev.frontmatter.title}</span>
        </a>
      )}
      {next && (
        <a
          class="next"
          href={next.url}
          aria-label={`다음 글: ${next.frontmatter.title}`}
        >
          <span class="label">{next.frontmatter.title}</span>
          <span class="spacer" aria-hidden="true" />
          <span class="icon" aria-hidden="true">
            →
          </span>
        </a>
      )}
    </nav>
  )
}

<style>
  .post-pager {
    display: grid;
    grid-template-columns: 1fr 1fr;
    align-items: center;
    gap: 12px;
    margin-top: 40px;
    padding-top: 20px;
    border-top: 1px solid var(--gray-700);
  }

  .prev,
  .next {
    color: var(--external-link-color);
    text-decoration: none;
    max-width: 100%;
    display: grid;
    gap: 8px;
    align-items: start;
    font-size: 0.9rem;
  }

  .prev {
    grid-column: 1;
    justify-self: start;
    grid-template-columns: auto 8px 1fr; /* 아이콘 | spacer | 텍스트 */
    text-align: left;
  }
  .next {
    grid-column: 2;
    justify-self: end;
    grid-template-columns: 1fr 8px auto; /* 텍스트 | spacer | 아이콘 */
    text-align: right;
  }
  .icon {
    color: var(--external-link-color);
    line-height: 1.3;
  }

  .label {
    color: var(--external-link-color);
    display: block;
    overflow-wrap: anywhere; /* 긴 단어 줄바꿈 허용 */
    word-break: break-word;
    line-height: 1.3;
  }

  .spacer {
    width: 8px;
    height: 1px;
  }

  .prev:hover,
  .next:hover {
    color: var(--hover-color);
  }
</style>
